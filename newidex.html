<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <title>手机 HUD 拖拽版</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
    <meta name="theme-color" content="#000" />

    <style>
      /* CSS 变量：字号、颜色（RGB）、遮罩透明度、文字透明度 */
      :root { --fs: 12vh; --rgb: 0,255,0; --alpha: 0; --text-alpha: 1; }

      /* 基础重置 */
      * { margin: 0; padding: 0; box-sizing: border-box; }
      html, body {
        height: 100%;
        background: #000;
        color: rgba(var(--rgb), var(--text-alpha));
        overflow: hidden;
        font-family: Roboto, Helvetica, Arial, sans-serif;
      }

      /* 可拖拽通用类 */
      .draggable { position: absolute; touch-action: none; user-select: none; cursor: move; z-index: 1001; }

      /* HUD 文字样式 */
      .speed { font-size: var(--fs); font-weight: 700; letter-spacing: -0.05em; }
      .unit { font-size: calc(var(--fs) * 0.5); margin-left: 0.2em; }
      .distance { font-size: calc(var(--fs) * 0.45); }

      /* 可缩放图标容器与图片 */
      .icon-wrapper { width: 18vh; height: 18vh; display: block; overflow: hidden; }
      .icon-img { width: 100%; height: 100%; display: block; object-fit: contain; }

      /* 缩放手柄（更明显的样式） */
      .resize-handle {
        position: absolute;
        right: 8px;
        bottom: 8px;
        width: 28px;
        height: 28px;
        background: linear-gradient(135deg, rgba(255,255,255,0.18) 25%, rgba(0,0,0,0.05) 25%, rgba(255,255,255,0.18) 50%, rgba(0,0,0,0.05) 50%, rgba(255,255,255,0.18) 75%, rgba(0,0,0,0.05) 75%);
        background-size: 10px 10px;
        border-radius: 6px;
        border: 2px solid rgba(255,255,255,0.18);
        cursor: nwse-resize;
        z-index: 1002;
        box-shadow: 0 6px 18px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.05);
        touch-action: none;
        transition: transform 120ms ease, box-shadow 120ms ease;
      }
      .resize-handle:hover { transform: scale(1.08); box-shadow: 0 8px 22px rgba(0,0,0,0.7), inset 0 1px 0 rgba(255,255,255,0.08); }
      .resize-handle:active { transform: scale(0.98); }

      /* 遮罩层 */
      .dimLayer { position: fixed; inset: 0; background: #000; opacity: var(--alpha); pointer-events: none; }

      /* 控制面板 */
      .panel {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.6);
        color: #fff;
        padding: 10px 20px;
        border-radius: 8px;
        display: none;
        gap: 12px;
        align-items: center;
        font-size: 14px;
      }
      body.showPanel .panel { display: flex; }
      .panel input { width: 120px; }

      /* 示例图片：可缩放的包装器 */
      .img-wrapper { width: 140px; height: 90px; border-radius: 8px; box-shadow: 0 6px 18px rgba(0,0,0,0.6); border: 2px solid rgba(255,255,255,0.06); z-index: 90; overflow: hidden; display: block; }
      /* 将示例图片强制置于更低层，避免遮挡文字 */
      #exampleImgWrapper { z-index: 50 !important; }
      /* 元素检查器样式 */
      .inspector {
        position: fixed;
        min-width: 220px;
        background: rgba(20,20,20,0.95);
        color: #fff;
        padding: 8px;
        border-radius: 8px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.6);
        z-index: 2000;
        font-size: 13px;
        display: none;
      }
      .inspector .ins-row{display:flex;align-items:center;justify-content:space-between;margin:6px 0}
      .inspector label{flex:1;margin-right:8px}
      .tint-overlay{position:absolute;inset:0;pointer-events:none;mix-blend-mode:multiply;opacity:0}
      .example-img { width: 100%; height: 100%; display: block; object-fit: cover; }

      /* HUD 容器镜像样式（翻转所有 HUD 子元素） */
      #hudRoot.mirrored { transform: scaleX(-1); transform-origin: 50% 50%; }

      /* 面板切换按钮 */
      #togglePanelBtn { position: fixed; left: 12px; bottom: 18px; padding: 8px 10px; border-radius: 6px; background: rgba(255,255,255,0.06); color: inherit; border: 1px solid rgba(255,255,255,0.06); backdrop-filter: blur(4px); z-index: 1000; }
    </style>
  </head>

  <body>
    <!-- 面板开关 -->
    <button id="togglePanelBtn">显示/隐藏</button>

    <!-- HUD 根容器（用于整体镜像翻转） -->
    <div id="hudRoot">
    <!-- ===== 可拖拽元素 ===== -->
    <div id="speed" class="draggable speed"><span id="spdVal">0</span><span class="unit">km/h</span></div>
    <div id="distance" class="draggable distance">800 m</div>

    <!-- 四个方向图标（每次仅显示一个，支持拖动与缩放） -->
    <div id="iconStraight" class="draggable icon-wrapper">
      <svg class="icon-img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 151 262" preserveAspectRatio="xMidYMid meet">
        <path d="M0 0 C4.09705164 1.36568388 5.1532323 4.08035179 7.25 7.625 C8.13958618 9.0886649 9.03166831 10.55081472 9.92578125 12.01171875 C10.41385254 12.81013184 10.90192383 13.60854492 11.40478516 14.43115234 C14.3360128 19.1514427 17.39175422 23.7906127 20.4375 28.4375 C21.73188947 30.41528694 23.02616146 32.39315078 24.3203125 34.37109375 C24.94454102 35.32483887 25.56876953 36.27858398 26.21191406 37.26123047 C29.201817 41.84079507 32.16341256 46.43857305 35.12402344 51.03710938 C37.34940009 54.48383204 39.60214045 57.90863221 41.8984375 61.30859375 C42.36660889 62.00275391 42.83478027 62.69691406 43.31713867 63.41210938 C44.20888068 64.73010185 45.10467337 66.04536574 46.00512695 67.35742188 C49 71.78084508 49 71.78084508 49 74 C41.08 74 33.16 74 25 74 C25 102.38 25 130.76 25 160 C9.16 160 -6.68 160 -23 160 C-23 131.62 -23 103.24 -23 74 C-30.92 74 -38.84 74 -47 74 C-45.30449174 69.76122935 -43.42728984 66.44666874 -40.875 62.75 C-36.23339863 55.90883056 -31.75482243 48.97199313 -27.3125 42 C-21.83318145 33.41007427 -16.31907053 24.84454434 -10.75 16.3125 C-10.13036377 15.36310547 -9.51072754 14.41371094 -8.87231445 13.43554688 C-5.93583814 8.94279098 -2.9874698 4.45902051 0 0 Z M0 13 C-1.3718815 14.72371064 -1.3718815 14.72371064 -2.73046875 17.00390625 C-3.55345459 18.31681641 -3.55345459 18.31681641 -4.39306641 19.65625 C-4.98522949 20.6153125 -5.57739258 21.574375 -6.1875 22.5625 C-7.44796633 24.5750037 -8.7097295 26.58669565 -9.97265625 28.59765625 C-10.63023926 29.64711426 -11.28782227 30.69657227 -11.96533203 31.77783203 C-15.29717742 37.05425337 -18.70898735 42.27781974 -22.125 47.5 C-22.75172607 48.4597876 -23.37845215 49.4195752 -24.02416992 50.40844727 C-24.9132605 51.76860962 -24.9132605 51.76860962 -25.8203125 53.15625 C-26.64644043 54.42082031 -26.64644043 54.42082031 -27.48925781 55.7109375 C-28.78064182 57.66763052 -30.09962544 59.60085318 -31.4296875 61.53125 C-33.1789009 63.7936152 -33.1789009 63.7936152 -33 66 C-27.39 66 -21.78 66 -16 66 C-16 94.71 -16 123.42 -16 153 C-4.78 153 6.44 153 18 153 C18 124.29 18 95.58 18 66 C23.61 66 29.22 66 35 66 C33.56076341 62.40190852 32.41237485 59.86388773 30.34765625 56.734375 C29.82381348 55.93507568 29.2999707 55.13577637 28.76025391 54.31225586 C28.19999512 53.46671143 27.63973633 52.62116699 27.0625 51.75 C25.88392426 49.954552 24.70554212 48.15897691 23.52734375 46.36328125 C22.93550293 45.46432129 22.34366211 44.56536133 21.73388672 43.63916016 C19.17911085 39.75051933 16.65093804 35.84490786 14.125 31.9375 C13.67592285 31.24567627 13.2268457 30.55385254 12.76416016 29.84106445 C10.75717708 26.74488503 8.76752043 23.64145475 6.83203125 20.5 C6.20683594 19.489375 5.58164063 18.47875 4.9375 17.4375 C4.41027344 16.56996094 3.88304687 15.70242187 3.33984375 14.80859375 C2.89769531 14.21175781 2.45554688 13.61492188 2 13 C1.34 13 0.68 13 0 13 Z " fill="currentColor" transform="translate(74,0)"/>
      </svg>
      <div class="resize-handle"></div>
    </div>

    <div id="iconLeft" class="draggable icon-wrapper">
      <svg class="icon-img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 202 255" preserveAspectRatio="xMidYMid meet">
        <path d="M0 0 C1.32 0.66 2.64 1.32 4 2 C4 6.29 4 10.58 4 15 C5.22928223 14.97905273 6.45856445 14.95810547 7.72509766 14.93652344 C12.35078971 14.86330916 16.97643221 14.81790854 21.60253906 14.78027344 C23.59253596 14.76034132 25.58247571 14.73318548 27.57226562 14.69824219 C48.03738976 14.34823503 63.33452398 17.26800448 78.74609375 31.71484375 C91.50492415 44.65057301 95.39569423 59.68022899 95.33988953 77.35832214 C95.32457577 79.20112375 95.30892789 81.04392262 95.29296875 82.88671875 C95.28736376 84.79913498 95.28309794 86.71155556 95.28010559 88.62397766 C95.26872785 93.62332342 95.23932259 98.62240189 95.20599365 103.62164307 C95.17513921 108.73665757 95.16156759 113.85171585 95.14648438 118.96679688 C95.11444525 128.97798112 95.06333581 138.98896821 95 149 C89.17928378 149.02464638 83.35859766 149.0428343 77.5378418 149.05493164 C75.55606559 149.05997267 73.57429311 149.06680538 71.5925293 149.07543945 C68.75047891 149.08751515 65.90847753 149.09323045 63.06640625 149.09765625 C61.72891075 149.10539818 61.72891075 149.10539818 60.36439514 149.11329651 C58.24259399 149.11349177 56.1208922 149.0621003 54 149 C52.06067088 147.06067088 52.84608619 143.37608451 52.84228516 140.72973633 C52.83720444 139.96869598 52.83212372 139.20765564 52.82688904 138.42355347 C52.81616101 136.76477536 52.80755044 135.10598255 52.80076981 133.44718361 C52.7890086 130.81999207 52.76956109 128.19296701 52.74765015 125.56584167 C52.68595496 118.09399987 52.63205061 110.62217234 52.59863281 103.15014648 C52.57765919 98.58417563 52.542328 94.01850344 52.49787521 89.45270348 C52.4837292 87.71326915 52.47499593 85.97378193 52.47182083 84.23429298 C52.46689908 81.7949578 52.44370725 79.35641074 52.41650391 76.91723633 C52.41951004 76.20167068 52.42251617 75.48610504 52.4256134 74.74885559 C52.34869968 70.09283448 51.26031639 67.03334434 49 63 C49 62.34 49 61.68 49 61 C48.21625 60.690625 47.4325 60.38125 46.625 60.0625 C44 59 44 59 42 58 C39.15791974 57.84293669 36.33662693 57.7415043 33.4921875 57.68359375 C32.23125778 57.6524221 32.23125778 57.6524221 30.94485474 57.62062073 C28.25498765 57.55514561 25.56502157 57.4962498 22.875 57.4375 C21.05337511 57.39431284 19.23176029 57.35069848 17.41015625 57.30664062 C12.94020606 57.19946632 8.47015614 57.09819315 4 57 C4 61.29 4 65.58 4 70 C-1 71 -1 71 -3.23130798 70.052948 C-3.98376297 69.55062653 -4.73621796 69.04830505 -5.51147461 68.53076172 C-6.37264389 67.96622284 -7.23381317 67.40168396 -8.12107849 66.82003784 C-9.49780479 65.88431442 -9.49780479 65.88431442 -10.90234375 64.9296875 C-11.85766495 64.29644562 -12.81298615 63.66320374 -13.79725647 63.01077271 C-16.85347376 60.97932554 -19.89513218 58.92711446 -22.9375 56.875 C-24.98286654 55.51433524 -27.02908141 54.15494477 -29.07617188 52.796875 C-31.03982394 51.48812092 -33.0027391 50.17826035 -34.96484375 48.8671875 C-35.88063705 48.25551727 -36.79643036 47.64384705 -37.73997498 47.01364136 C-42.37700915 43.88345621 -46.78389823 40.67949123 -51 37 C-50.63532071 34.39365313 -50.26754951 33.24393446 -48.29440308 31.44494629 C-47.55384674 30.95071167 -46.81329041 30.45647705 -46.05029297 29.94726562 C-45.21207001 29.37987671 -44.37384705 28.81248779 -43.51022339 28.22790527 C-42.14004562 27.32618591 -42.14004562 27.32618591 -40.7421875 26.40625 C-39.80577423 25.77771118 -38.86936096 25.14917236 -37.90457153 24.50158691 C-34.90175669 22.49028374 -31.88843637 20.49534459 -28.875 18.5 C-26.86652084 17.15594361 -24.85870002 15.81090286 -22.8515625 14.46484375 C-17.58706039 10.94589171 -12.32370695 7.42893 -7 4 C-6.32696838 3.54858643 -5.65393677 3.09717285 -4.96051025 2.63208008 C-3.12158203 1.46289062 -3.12158203 1.46289062 0 0 Z M-8.53173828 13.203125 C-9.25233429 13.68362305 -9.9729303 14.16412109 -10.71536255 14.65917969 C-11.88106277 15.44663574 -11.88106277 15.44663574 -13.0703125 16.25 C-13.86654022 16.78270508 -14.66276794 17.31541016 -15.48312378 17.86425781 C-18.0333268 19.57187503 -20.57918333 21.28585193 -23.125 23 C-24.84997858 24.15667043 -26.57523547 25.31292591 -28.30078125 26.46875 C-32.5371024 29.30768961 -36.76953542 32.15234131 -41 35 C-37.20783194 39.06843379 -33.20820097 42.07035854 -28.546875 45.08203125 C-27.49563446 45.77059456 -27.49563446 45.77059456 -26.42315674 46.47306824 C-24.95257541 47.43467079 -23.48010913 48.39339631 -22.00585938 49.34936523 C-19.73918412 50.8195151 -17.47856052 52.29862163 -15.21875 53.77929688 C-13.78679978 54.71406494 -12.35451983 55.64832812 -10.921875 56.58203125 C-10.24276062 57.02569534 -9.56364624 57.46935944 -8.86395264 57.9264679 C-6.13440775 60.04977613 -6.13440775 60.04977613 -3 61 C-2.34 57.7 -1.68 54.4 -1 51 C4.79829005 50.90043882 10.59607242 50.82820654 16.39501953 50.78027344 C18.36385782 50.76027213 20.33263756 50.73306198 22.30126953 50.69824219 C25.14630658 50.64921469 27.99055215 50.62691618 30.8359375 50.609375 C31.70302338 50.58872986 32.57010925 50.56808472 33.46347046 50.54681396 C40.28280431 50.54436158 47.22529015 51.88215307 52.62411499 56.3414917 C57.77965603 62.11576475 59.36887885 68.14903156 59.43237305 75.67944336 C59.44766052 76.77825333 59.44766052 76.77825333 59.46325684 77.89926147 C59.4932074 80.29620184 59.50262486 82.69274143 59.51171875 85.08984375 C59.52857881 86.76137094 59.54673084 88.43288556 59.56611633 90.10438538 C59.61347854 94.48548451 59.64337676 98.86653264 59.66955566 103.24780273 C59.699431 107.72585113 59.74593727 112.20372403 59.79101562 116.68164062 C59.87689199 125.45435512 59.94276794 134.22705182 60 143 C69.57 143 79.14 143 89 143 C89.04541901 133.83688891 89.08201207 124.67385418 89.10362434 115.5106554 C89.11400391 111.25453782 89.12805485 106.99850212 89.15087891 102.74243164 C89.17281741 98.62511594 89.18461228 94.50787835 89.18975449 90.39050865 C89.19341294 88.82985901 89.20055534 87.26921301 89.21146011 85.70859718 C89.34019218 66.49859004 86.93476778 50.98938794 74 36 C61.29591523 23.8462727 46.12190602 20.79934811 29.15234375 20.90234375 C27.80638878 20.90446617 27.80638878 20.90446617 26.4332428 20.90663147 C23.60129286 20.9121749 20.76942555 20.92471642 17.9375 20.9375 C16.00325636 20.94252233 14.06901147 20.94708394 12.13476562 20.95117188 C7.42314583 20.96212571 2.71158687 20.97935047 -2 21 C-2.33 17.7 -2.66 14.4 -3 11 C-5.54554802 11 -6.42622532 11.78963378 -8.53173828 13.203125 Z " fill="currentColor" transform="translate(52,0)"/>
      </svg>
      <div class="resize-handle"></div>
    </div>

    <div id="iconRight" class="draggable icon-wrapper">
      <svg class="icon-img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 202 255" preserveAspectRatio="xMidYMid meet">
        <path d="M0 0 C2.56518307 1.19540825 4.83919344 2.51122816 7.2021637 4.06478882 C8.06978836 4.6323288 8.93741302 5.19986877 9.83132935 5.78460693 C10.75542099 6.39607574 11.67951263 7.00754456 12.63160706 7.63754272 C13.5916716 8.26891144 14.55173615 8.90028015 15.54089355 9.55078125 C17.56714903 10.88508911 19.59190181 12.22168136 21.61524963 13.56039429 C24.70929263 15.60606667 27.80971793 17.64178246 30.91090393 19.67660522 C32.88069752 20.97548928 34.85011147 22.27494928 36.81910706 23.57504272 C38.20828087 24.48617325 38.20828087 24.48617325 39.6255188 25.41571045 C40.4899913 25.98955475 41.35446381 26.56339905 42.24513245 27.15463257 C43.38167015 27.90503311 43.38167015 27.90503311 44.54116821 28.67059326 C46.80746212 30.34909847 48.71451881 32.20097333 50.65895081 34.23910522 C49.19138421 37.87270061 47.36673151 39.47517609 44.18238831 41.70785522 C43.19464417 42.40265991 42.20690002 43.0974646 41.18922424 43.81332397 C40.01320393 44.62298997 38.83638589 45.43149801 37.65895081 46.23910522 C36.98851746 46.70203979 36.31808411 47.16497437 35.62733459 47.64193726 C31.01316294 50.82448383 26.37604547 53.97124855 21.72291565 57.0965271 C20.08290545 58.20103047 18.44622847 59.31049774 16.8127594 60.4246521 C14.42768775 62.05107454 12.03295733 63.66224468 9.63551331 65.27035522 C8.90837128 65.77022949 8.18122925 66.27010376 7.43205261 66.78512573 C1.03740967 71.03048033 1.03740967 71.03048033 -3.34104919 70.23910522 C-4.34104919 69.23910522 -4.34104919 69.23910522 -4.43870544 66.29769897 C-4.42710388 65.10273804 -4.41550232 63.9077771 -4.40354919 62.67660522 C-4.39452576 61.47906616 -4.38550232 60.2815271 -4.37620544 59.04769897 C-4.36460388 58.12086304 -4.35300232 57.1940271 -4.34104919 56.23910522 C-9.5010237 56.30817455 -14.66020272 56.39623385 -19.81956482 56.5015564 C-21.57305546 56.53471743 -23.32665058 56.56277665 -25.08030701 56.58554077 C-27.60777618 56.61924992 -30.13429557 56.67157215 -32.66136169 56.72738647 C-33.43972382 56.7337764 -34.21808594 56.74016632 -35.02003479 56.74674988 C-39.83022118 56.87536221 -43.1595893 57.62265223 -47.34104919 60.23910522 C-51.78499122 65.16347341 -52.49337893 68.22435467 -52.53050232 74.68637085 C-52.53879562 75.45398239 -52.54708893 76.22159393 -52.55563354 77.01246643 C-52.57304837 78.68159409 -52.58821127 80.3507464 -52.60140991 82.01991272 C-52.62240518 84.65867559 -52.64943005 87.29731457 -52.67808533 89.93600464 C-52.73782678 95.53699084 -52.78997051 101.1380342 -52.84104919 106.73910522 C-52.90022201 113.22774431 -52.96246526 119.71632209 -53.03292847 126.20484924 C-53.05956091 128.80955041 -53.08034024 131.41425756 -53.10093689 134.01901245 C-53.11753601 135.60995786 -53.1344075 137.20090045 -53.15159607 138.7918396 C-53.15578049 139.5202153 -53.1599649 140.248591 -53.16427612 140.9990387 C-53.22720573 146.0114183 -53.22720573 146.0114183 -54.34104919 148.23910522 C-60.00102966 148.28845448 -65.66088555 148.32480051 -71.32102966 148.34896851 C-73.24748414 148.35904105 -75.17392327 148.37269966 -77.10032654 148.38998413 C-79.86550171 148.41417763 -82.63047519 148.42557558 -85.39573669 148.43441772 C-86.2603653 148.4447403 -87.1249939 148.45506287 -88.01582336 148.46569824 C-90.1255844 148.46609629 -92.23485638 148.36175766 -94.34104919 148.23910522 C-97.22697686 145.35317756 -96.59490529 143.29863351 -96.59983826 139.25765991 C-96.60509521 138.17904694 -96.60509521 138.17904694 -96.61045837 137.0786438 C-96.61929311 134.68932561 -96.61341316 132.30030172 -96.60667419 129.91098022 C-96.60802212 128.24343815 -96.60996371 126.57589645 -96.61247253 124.90835571 C-96.61542758 121.40105473 -96.61112051 117.89385535 -96.60179138 114.38656616 C-96.59050225 109.9285694 -96.59688608 105.47081627 -96.60893631 101.01282883 C-96.61623562 97.56031532 -96.61382859 94.10785748 -96.60868073 90.6553421 C-96.60736086 89.01458964 -96.60893253 87.37383187 -96.61363983 85.73308563 C-96.65538293 67.06178806 -94.95151464 50.6699809 -83.34104919 35.23910522 C-82.66622498 34.31678101 -82.66622498 34.31678101 -81.97776794 33.37582397 C-73.94023944 23.16476664 -60.99625589 16.53515238 -48.34104919 14.23910522 C-44.86823142 13.98757562 -41.41519593 14.00479103 -37.93479919 14.04379272 C-36.4868396 14.04803757 -36.4868396 14.04803757 -35.0096283 14.05236816 C-31.95330442 14.06348398 -28.89728318 14.08857237 -25.84104919 14.11410522 C-23.75772012 14.12414615 -21.67438641 14.13327004 -19.59104919 14.14144897 C-14.50760082 14.16339511 -9.42437617 14.19786505 -4.34104919 14.23910522 C-4.34104919 9.61910522 -4.34104919 4.99910522 -4.34104919 0.23910522 C-2.34104919 -0.76089478 -2.34104919 -0.76089478 0 0 Z M1.65895081 9.23910522 C1.65895081 12.86910522 1.65895081 16.49910522 1.65895081 20.23910522 C0.52054749 20.22863159 -0.61785583 20.21815796 -1.79075623 20.20736694 C-6.08108784 20.17071504 -10.37140613 20.14804319 -14.66184998 20.12924194 C-16.50627482 20.11928597 -18.35068431 20.10571631 -20.1950531 20.08822632 C-41.16170233 19.54723124 -41.16170233 19.54723124 -60.77854919 25.98910522 C-61.79054382 26.52471069 -61.79054382 26.52471069 -62.82298279 27.07113647 C-74.94043959 33.65331306 -82.68661907 43.70891212 -87.21282959 56.75112915 C-89.76198298 65.88689731 -89.72679612 74.63910458 -89.63401794 84.03598022 C-89.62840963 85.72276427 -89.62414539 87.40955327 -89.62115479 89.09634399 C-89.60980309 93.49563537 -89.58042154 97.89462071 -89.54704285 102.29379272 C-89.51613104 106.79895897 -89.50260473 111.30417557 -89.48753357 115.80941772 C-89.45554058 124.61946836 -89.40285409 133.42921324 -89.34104919 142.23910522 C-79.77104919 142.23910522 -70.20104919 142.23910522 -60.34104919 142.23910522 C-60.33170349 139.97873413 -60.32235779 137.71836304 -60.31272888 135.38949585 C-60.27888491 127.90153103 -60.22329487 120.41383966 -60.15714645 112.92609406 C-60.11772253 108.38848982 -60.08550922 103.85107817 -60.0700531 99.31332397 C-60.05485285 94.92994586 -60.02034807 90.54709738 -59.97274017 86.16395569 C-59.95796097 84.49596269 -59.95001017 82.82789407 -59.94916534 81.15983582 C-59.933031 65.26995436 -59.933031 65.26995436 -55.34104919 58.23910522 C-55.01104919 57.24910522 -54.68104919 56.25910522 -54.34104919 55.23910522 C-52.77854919 54.23910522 -52.77854919 54.23910522 -50.34104919 53.23910522 C-49.18540466 52.72952271 -48.02976013 52.21994019 -46.83909607 51.69491577 C-41.85673748 49.84125242 -37.19891724 49.85765109 -31.93479919 49.94613647 C-30.9694928 49.95038132 -30.0041864 49.95462616 -29.0096283 49.95899963 C-25.95314089 49.97567425 -22.89733434 50.01330531 -19.84104919 50.05160522 C-17.75772544 50.06666657 -15.67439127 50.08035243 -13.59104919 50.09262085 C-8.50745705 50.12554099 -3.42436821 50.17724506 1.65895081 50.23910522 C1.65895081 53.53910522 1.65895081 56.83910522 1.65895081 60.23910522 C6.51239293 58.60887829 10.40133754 55.88406186 14.58473206 53.01254272 C15.33232285 52.50486359 16.07991364 51.99718445 16.85015869 51.47412109 C19.22698261 49.85855888 21.59924876 48.23644428 23.97145081 46.61410522 C25.58638849 45.51471094 27.20161969 44.41574768 28.81715393 43.31723022 C32.7678374 40.62950347 36.71444756 37.93589298 40.65895081 35.23910522 C36.60767527 31.88099138 32.36284147 28.94463501 27.98707581 26.03598022 C27.26405273 25.55332703 26.54102966 25.07067383 25.7960968 24.57339478 C24.27734186 23.56043995 22.75781704 22.54863856 21.23756409 21.53793335 C18.90044235 19.98344601 16.56667171 18.42401933 14.23316956 16.86410522 C12.7555024 15.87943389 11.27764459 14.89504859 9.79957581 13.91098022 C8.74809357 13.20796783 8.74809357 13.20796783 7.67536926 12.49075317 C4.8807663 10.25329258 4.8807663 10.25329258 1.65895081 9.23910522 Z " fill="currentColor" transform="translate(150.34104919433594,0.760894775390625)"/>
      </svg>
      <div class="resize-handle"></div>
    </div>

    <div id="iconUturn" class="draggable icon-wrapper">
      <svg class="icon-img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 233 254" preserveAspectRatio="xMidYMid meet">
        <path d="M0 0 C2.51353745 1.92283578 4.83677576 3.94480862 7.16015625 6.09375 C7.6490332 6.53638184 8.13791016 6.97901367 8.64160156 7.43505859 C39.10293348 35.26589442 54.13113659 76.8035534 58.16015625 117.09375 C69.54515625 117.58875 69.54515625 117.58875 81.16015625 118.09375 C78.4206654 120.83324085 76.0807224 123.02000343 73.02734375 125.2734375 C72.22949463 125.86648682 71.43164551 126.45953613 70.60961914 127.07055664 C69.76004639 127.69696045 68.91047363 128.32336426 68.03515625 128.96875 C62.61435752 132.97283379 57.23260541 136.99364653 52.015625 141.26171875 C51.20818848 141.9160791 50.40075195 142.57043945 49.56884766 143.24462891 C48.02911202 144.49916897 46.50090901 145.76802571 44.98583984 147.05224609 C43.08958317 148.5865982 41.31930809 149.95972277 39.16015625 151.09375 C34.84783515 150.52003477 32.062652 147.52902917 28.84765625 144.71875 C24.12887348 140.66864782 19.28009644 136.85988292 14.28515625 133.15625 C8.86550871 129.12860165 3.48066371 125.06431093 -1.83984375 120.90625 C-2.44554199 120.43646729 -3.05124023 119.96668457 -3.67529297 119.48266602 C-5.08299243 118.37744231 -6.46458207 117.23908512 -7.83984375 116.09375 C-7.83984375 115.76375 -7.83984375 115.43375 -7.83984375 115.09375 C-4.73569673 115.06471423 -1.63158466 115.0469393 1.47265625 115.03125 C2.35373047 115.02287109 3.23480469 115.01449219 4.14257812 115.00585938 C5.41391602 115.00102539 5.41391602 115.00102539 6.7109375 114.99609375 C7.49122314 114.99085693 8.27150879 114.98562012 9.07543945 114.98022461 C11.16015625 115.09375 11.16015625 115.09375 14.16015625 116.09375 C9.48179165 90.25285021 3.60643027 63.97689168 -14.83984375 44.09375 C-15.40058594 43.454375 -15.96132812 42.815 -16.5390625 42.15625 C-24.2355854 33.83180565 -33.93975336 29.0430088 -45.19921875 28.1328125 C-57.3575788 27.9529551 -66.95694166 33.61951156 -75.53515625 41.796875 C-76.29570313 42.55484375 -77.05625 43.3128125 -77.83984375 44.09375 C-78.45601563 44.68671875 -79.0721875 45.2796875 -79.70703125 45.890625 C-104.33731102 71.54243711 -107.27046993 112.58629966 -109.83984375 146.09375 C-115.49983398 146.11842467 -121.15979307 146.13659788 -126.81982422 146.14868164 C-128.74626206 146.15371787 -130.67269606 146.16054712 -132.59912109 146.16918945 C-135.36426743 146.18128608 -138.12936333 146.18698533 -140.89453125 146.19140625 C-142.19147415 146.19914818 -142.19147415 146.19914818 -143.51461792 146.20704651 C-149.61210034 146.20762171 -149.61210034 146.20762171 -151.83984375 145.09375 C-153.48220228 100.38510107 -141.2096797 54.27536924 -112.83984375 19.09375 C-112.1128125 18.18238281 -111.38578125 17.27101562 -110.63671875 16.33203125 C-81.85606289 -17.61848316 -36.94812989 -24.80149572 0 0 Z M-76.83984375 -0.90625 C-77.566875 -0.54789063 -78.29390625 -0.18953125 -79.04296875 0.1796875 C-108.57472553 15.56511323 -126.17574841 47.75623068 -135.9921875 78.29980469 C-141.73093357 97.21518777 -145.99221716 118.24731912 -144.83984375 138.09375 C-138.43824975 138.91413591 -132.22681874 139.22129513 -125.77734375 139.15625 C-124.91173828 139.15173828 -124.04613281 139.14722656 -123.15429688 139.14257812 C-121.04944836 139.13094913 -118.94463617 139.11302073 -116.83984375 139.09375 C-116.76991211 138.38057617 -116.69998047 137.66740234 -116.62792969 136.93261719 C-113.0150129 100.74536384 -106.57776151 59.19711402 -77.9765625 33.4140625 C-67.81343705 25.29197881 -55.05482265 19.62541901 -41.83984375 21.09375 C-26.10527767 23.5592803 -14.15165632 32.37563414 -4.56982422 44.73144531 C10.26772813 65.10521797 16.40776153 88.7529322 21.16015625 113.09375 C21.82406909 116.4276393 22.49231536 119.76064457 23.16015625 123.09375 C20.19015625 123.09375 17.22015625 123.09375 14.16015625 123.09375 C18.52375014 127.74173291 23.42000736 131.53401474 28.47265625 135.40625 C29.30861328 136.05142578 30.14457031 136.69660156 31.00585938 137.36132812 C33.05486857 138.94199236 35.10633069 140.51935229 37.16015625 142.09375 C40.38053768 140.60873475 43.08949182 138.77564484 45.92578125 136.65234375 C46.81523437 135.98654297 47.7046875 135.32074219 48.62109375 134.63476562 C49.54148438 133.94060547 50.461875 133.24644531 51.41015625 132.53125 C52.81394531 131.48420898 52.81394531 131.48420898 54.24609375 130.41601562 C55.57253906 129.41924805 55.57253906 129.41924805 56.92578125 128.40234375 C57.73821289 127.79189209 58.55064453 127.18144043 59.38769531 126.55249023 C59.97260742 126.07110596 60.55751953 125.58972168 61.16015625 125.09375 C61.16015625 124.76375 61.16015625 124.43375 61.16015625 124.09375 C57.86015625 124.09375 54.56015625 124.09375 51.16015625 124.09375 C51.12148438 122.92585938 51.12148438 122.92585938 51.08203125 121.734375 C48.98856965 80.43608704 31.83626949 39.65007943 1.97265625 10.96875 C-11.30658967 -0.85982199 -28.2798592 -8.34370671 -46.15234375 -8.21875 C-47.39346924 -8.21246582 -47.39346924 -8.21246582 -48.65966797 -8.20605469 C-58.84728562 -8.0193446 -67.77675325 -5.5039492 -76.83984375 -0.90625 Z " fill="currentColor" transform="translate(151.83984375,14.90625)"/>
      </svg>
      <div class="resize-handle"></div>
    </div>

    <!-- 亮度遮罩 -->
    <div class="dimLayer"></div>

    <!-- 示例图片：封装为可拖拽、可缩放的容器，使用本地资源 -->
    <div id="exampleImgWrapper" class="draggable img-wrapper">
      <svg id="exampleImg" class="example-img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 253 625" preserveAspectRatio="xMidYMid meet">
        <path d="M0 0 C31.35 0 62.7 0 95 0 C99.34080526 33.83846624 99.34080526 33.83846624 101.37902998 49.72751832 C103.10567127 63.18760853 104.83233312 76.6476961 106.55904664 90.10777704 C108.00821825 101.40436802 109.45736593 112.70096206 110.90649414 123.99755859 C111.04166458 125.05127071 111.17683502 126.10498282 111.31610154 127.19062561 C115.24515863 157.81941351 119.17337559 188.44830904 123.10082831 219.0773027 C125.62605121 238.77070729 128.15149395 258.46408368 130.677017 278.15744978 C131.09847916 281.44391685 131.51993448 284.73038479 131.94138885 288.01685286 C138.69691404 340.69555849 145.4586444 393.37345148 152.24189353 446.04859483 C153.5297905 456.04992642 154.81685203 466.05136522 156.10327148 476.05288696 C156.19050213 476.73105914 156.27773279 477.40923131 156.36760679 478.10795416 C157.13737463 484.09250066 157.90710091 490.07705249 158.67669058 496.0616219 C160.59500524 510.9788977 162.51627134 525.8957855 164.44281024 540.81200147 C165.61787956 549.91182537 166.78948012 559.01209127 167.95817167 568.11273646 C168.73881479 574.19043298 169.52343744 580.26759498 170.31150484 586.34433305 C170.77853287 589.9538679 171.24137502 593.56392958 171.70290828 597.17417073 C171.913025 598.81120573 172.1248518 600.44802236 172.33858037 602.08458972 C172.62733527 604.29747052 172.90984042 606.51106443 173.19081116 608.72494507 C173.34839936 609.94701849 173.50598757 611.16909191 173.66835117 612.42819786 C174.02511844 616.27052137 174 620.14114876 174 624 C90.51 624 7.02 624 -79 624 C-77.84379508 605.50072123 -77.84379508 605.50072123 -76.63113123 596.25015795 C-76.54202562 595.56546268 -76.45292 594.88076741 -76.36111421 594.1753238 C-76.26853847 593.46468771 -76.17596273 592.75405162 -76.08058167 592.0218811 C-75.88332039 590.47742316 -75.68651331 588.93290715 -75.49011368 587.3883394 C-74.95430366 583.18483263 -74.41213417 578.98216808 -73.86883414 574.77962375 C-73.28039535 570.21888076 -72.69799625 565.65736589 -72.11482239 561.09594727 C-71.09953341 553.16117924 -70.08044765 545.22690629 -69.05877876 537.29295731 C-67.55334321 525.60218118 -66.053742 513.910662 -64.55536842 502.21897893 C-62.08632642 482.95454247 -59.61259708 463.69071087 -57.13598633 444.42724609 C-54.79591646 426.22574405 -52.45797932 408.0239705 -50.12329102 389.82177734 C-49.98269621 388.72565291 -49.8421014 387.62952847 -49.69724615 386.50018814 C-49.13010305 382.07848283 -48.56297654 377.65677539 -47.99587116 373.23506524 C-34.64283808 269.12214219 -21.246211 165.01481775 -7.84291077 60.90835571 C-7.71826112 59.94017325 -7.59361147 58.97199079 -7.46518456 57.97446947 C-4.97715432 38.64959936 -2.48851039 19.32480829 0 0 Z " fill="#7C9BDA" transform="translate(79,0)"/>
      </svg>
      <div class="resize-handle"></div>
    </div>
      </div><!-- /#hudRoot -->

    <!-- 元素检查器（点击元素时显示） -->
    <div id="inspector" class="inspector" aria-hidden="true">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
        <strong id="inspectorTitle">编辑元素</strong>
        <button id="inspectorClose" style="background:transparent;border:none;color:#fff;font-size:16px;cursor:pointer">✕</button>
      </div>
      <div class="ins-row"><label>宽度 (px)</label><input id="inspWidth" type="number" style="width:80px"></div>
      <div class="ins-row"><label>高度 (px)</label><input id="inspHeight" type="number" style="width:80px"></div>
      <div class="ins-row"><label>字号 (px)</label><input id="inspFontSize" type="number" style="width:80px"></div>
      <div class="ins-row"><label>颜色</label><input id="inspColor" type="color" style="width:80px"></div>
      <div class="ins-row"><label>色度</label><input id="inspTintAlpha" type="range" min="0" max="1" step="0.01" style="width:calc(100% - 88px)"><input id="inspTintAlphaNum" type="number" min="0" max="1" step="0.01" style="width:80px"></div>
      <div class="ins-row"><label>亮度</label><input id="inspBrightness" type="range" min="0.2" max="2" step="0.01" style="width:calc(100% - 88px)"><input id="inspBrightnessNum" type="number" min="0.2" max="2" step="0.01" style="width:80px"></div>
      <div class="ins-row"><label>透明度</label><input id="inspOpacity" type="range" min="0" max="1" step="0.01" style="width:calc(100% - 88px)"><input id="inspOpacityNum" type="number" min="0" max="1" step="0.01" style="width:80px"></div>
      <div class="ins-row"><label>图层 (z)</label><input id="inspZ" type="number" min="0" max="9999" style="width:80px"></div>
      <div style="display:flex;gap:8px;margin-top:8px"><button id="insApply" style="flex:1">应用</button><button id="insReset" style="flex:1">重置</button></div>
    </div>

      <!-- 控制面板（整体交互已注释，仅保留镜像指令） -->
      <div id="panel" class="panel draggable">
        <button id="mirrorBtn">镜像</button>
      </div>
    <script>
      /* ------------------ 配置（字号、RGB、亮度） ------------------ */
      const cfg = { fs: 12, rgb: [0,255,0], alpha: 0, mirror: false, textAlpha: 1 };
      Object.assign(cfg, JSON.parse(localStorage.getItem('hudCfg') || '{}'));

      function apply(){
        document.documentElement.style.setProperty('--fs', cfg.fs + 'vh');
        const rgbVal = Array.isArray(cfg.rgb) ? cfg.rgb.join(',') : (cfg.rgb || '0,255,0');
        document.documentElement.style.setProperty('--rgb', rgbVal);
        document.documentElement.style.setProperty('--alpha', cfg.alpha);
        document.documentElement.style.setProperty('--text-alpha', cfg.textAlpha);
        const hudRoot = document.getElementById('hudRoot');
        if (hudRoot) hudRoot.classList.toggle('mirrored', cfg.mirror);
        localStorage.setItem('hudCfg', JSON.stringify(cfg));
      }

      function clampRGB(v){ if (isNaN(v)) return 0; return Math.max(0, Math.min(255, Math.round(v))); }

      // 只保留镜像指令的绑定与配置恢复
      document.getElementById('mirrorBtn').onclick = () => { cfg.mirror = !cfg.mirror; apply(); };
      apply();

      /* ------------------ 面板显隐（按钮控制） ------------------ */
      document.getElementById('togglePanelBtn').onclick = () => {
        document.body.classList.toggle('showPanel');
      };

      /* ------------------ 元素检查器：对单个元素进行样式编辑 ------------------ */
      const stylesKey = 'hudStyles';
      const hudStyles = JSON.parse(localStorage.getItem(stylesKey) || '{}');
      let inspectorTarget = null;

      const inspector = document.getElementById('inspector');
      const inspectorTitle = document.getElementById('inspectorTitle');
      const inspWidth = document.getElementById('inspWidth');
      const inspHeight = document.getElementById('inspHeight');
      const inspFontSize = document.getElementById('inspFontSize');
      const inspColor = document.getElementById('inspColor');
      const inspTintAlpha = document.getElementById('inspTintAlpha');
      const inspTintAlphaNum = document.getElementById('inspTintAlphaNum');
      const inspBrightness = document.getElementById('inspBrightness');
      const inspBrightnessNum = document.getElementById('inspBrightnessNum');
      const inspOpacity = document.getElementById('inspOpacity');
      const inspOpacityNum = document.getElementById('inspOpacityNum');
      const inspZ = document.getElementById('inspZ');
      const insClose = document.getElementById('inspectorClose');
      const insApply = document.getElementById('insApply');
      const insReset = document.getElementById('insReset');

      function applySavedStyles(id, el){
        const s = hudStyles[id];
        if (!s) return;
        if (s.width) el.style.width = s.width;
        if (s.height) el.style.height = s.height;
        if (s.fontSize) el.style.fontSize = s.fontSize;
        if (s.color) {
          // 如果包含 png 图片，尽量恢复重着色图（dataUrl）或尝试 recolor
          const img = el.querySelector && el.querySelector('img');
          if (img && (s.recolored || isPngSrc(img.src) || isPngSrc(s.originalSrc || img.dataset.__origSrc))){
            if (s.recolored){ img.src = s.recolored; }
            else if (s.color){ // 尝试重新着色原图
              const orig = s.originalSrc || img.dataset.__origSrc || img.src;
              img.dataset.__origSrc = orig;
              recolorPngImage(img, s.color).then(res=>{ if(res.success) { s.recolored = res.dataUrl; localStorage.setItem(stylesKey, JSON.stringify(hudStyles)); } else ensureTint(el, s.color, s.tintAlpha || 0); });
            }
          } else {
            if (el.classList.contains('speed') || el.classList.contains('distance')) el.style.color = s.color;
            else ensureTint(el, s.color, s.tintAlpha || 0);
          }
        }
        if (s.brightness) el.style.filter = `brightness(${s.brightness})`;
        if (typeof s.opacity !== 'undefined') el.style.opacity = s.opacity;
        if (s.zIndex) el.style.zIndex = s.zIndex;
      }

      function ensureTint(el, color, alpha){
        if (!el.classList.contains('icon-wrapper')) return;
        el.style.position = el.style.position || 'absolute';
        let ov = el.querySelector('.tint-overlay');
        if (!ov){ ov = document.createElement('div'); ov.className = 'tint-overlay'; el.appendChild(ov); }
        ov.style.background = color || '#000000';
        ov.style.opacity = (typeof alpha === 'number') ? alpha : 0;
      }

      // 尝试使用 canvas 重着色 PNG（保留高光/阴影），若失败则回退到 overlay
      function isPngSrc(src){ if(!src) return false; return src.indexOf('.png') !== -1 || src.indexOf('image/png')!==-1; }

      async function recolorPngImage(imgEl, hexColor){
        try{
          const origSrc = imgEl.getAttribute('src');
          const img = new Image();
          img.crossOrigin = 'Anonymous';
          img.src = origSrc;
          await new Promise((res,rej)=>{ img.onload=res; img.onerror=()=>rej(new Error('img load error')) });
          const w = img.naturalWidth || img.width; const h = img.naturalHeight || img.height;
          const c = document.createElement('canvas'); c.width = w; c.height = h; const ctx = c.getContext('2d');
          ctx.drawImage(img,0,0,w,h);
          const data = ctx.getImageData(0,0,w,h);
          const d = data.data;
          const tr = parseInt(hexColor.slice(1,3),16);
          const tg = parseInt(hexColor.slice(3,5),16);
          const tb = parseInt(hexColor.slice(5,7),16);
          for(let i=0;i<d.length;i+=4){
            const r=d[i], g=d[i+1], b=d[i+2], a=d[i+3];
            if(a===0) continue;
            const lum = 0.299*r + 0.587*g + 0.114*b; // 灰度用于保留明暗
            d[i]   = Math.round(tr * (lum/255));
            d[i+1] = Math.round(tg * (lum/255));
            d[i+2] = Math.round(tb * (lum/255));
            // alpha 保持不变
          }
          ctx.putImageData(data,0,0);
          const url = c.toDataURL('image/png');
          // 保存原始 src 以便重置
          if(!imgEl.dataset.__origSrc) imgEl.dataset.__origSrc = origSrc;
          imgEl.src = url;
          return { success:true, dataUrl:url };
        }catch(err){
          console.warn('recolorPngImage failed, fallback to overlay', err);
          return { success:false };
        }
      }

      // 初始化：应用已保存样式
      document.querySelectorAll('.draggable').forEach(el => {
        if (hudStyles[el.id]) applySavedStyles(el.id, el);
      });

      // 点击显示检查器（点击时阻止拖拽起始冒泡）
      document.querySelectorAll('.draggable').forEach(el => {
        el.addEventListener('click', e => {
          e.stopPropagation();
          showInspectorFor(el);
        });
      });

      function showInspectorFor(el){
        inspectorTarget = el;
        inspectorTitle.textContent = el.id || el.className || '元素';
        const rect = el.getBoundingClientRect();
        inspector.style.left = Math.min(window.innerWidth - 240, rect.right + 8) + 'px';
        inspector.style.top = Math.max(8, rect.top) + 'px';
        inspector.style.display = 'block';
        inspector.setAttribute('aria-hidden','false');

        // 填充当前值
        const cs = getComputedStyle(el);
        inspWidth.value = parseInt(cs.width) || '';
        inspHeight.value = parseInt(cs.height) || '';
        inspFontSize.value = parseInt(cs.fontSize) || '';
        // color to hex
        const col = cs.color;
        inspColor.value = rgbToHex(col) || '#00ff00';
        // tint
        const ov = el.querySelector && el.querySelector('.tint-overlay');
        inspTintAlpha.value = ov ? parseFloat(ov.style.opacity || 0) : 0; if (inspTintAlphaNum) inspTintAlphaNum.value = inspTintAlpha.value;
        inspBrightness.value = (el.style.filter && parseBrightness(el.style.filter)) || 1; if (inspBrightnessNum) inspBrightnessNum.value = inspBrightness.value;
        inspOpacity.value = parseFloat(cs.opacity) || 1; if (inspOpacityNum) inspOpacityNum.value = inspOpacity.value;
        inspZ.value = el.style.zIndex || parseInt(cs.zIndex) || 1001;
      }

      function hideInspector(){ inspector.style.display='none'; inspector.setAttribute('aria-hidden','true'); inspectorTarget=null; }
      insClose.addEventListener('click', hideInspector);

      function parseBrightness(filter){
        const m = /brightness\(([^)]+)\)/.exec(filter||''); return m ? parseFloat(m[1]) : 1;
      }

      function rgbToHex(rgb){
        if (!rgb) return null;
        const m = rgb.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
        if (!m) return null;
        return '#'+[1,2,3].map(i=>parseInt(m[i]).toString(16).padStart(2,'0')).join('');
      }

      // 应用按钮
      insApply.addEventListener('click', ()=>{
        if (!inspectorTarget) return;
        const el = inspectorTarget;
        const id = el.id || ('el_'+Math.random().toString(36).slice(2,8));
        const s = hudStyles[id] = hudStyles[id] || {};
        if (inspWidth.value) { el.style.width = inspWidth.value + 'px'; s.width = el.style.width; } else { el.style.width = ''; delete s.width; }
        if (inspHeight.value) { el.style.height = inspHeight.value + 'px'; s.height = el.style.height; } else { el.style.height = ''; delete s.height; }
        if (inspFontSize.value) { el.style.fontSize = inspFontSize.value + 'px'; s.fontSize = el.style.fontSize; } else { el.style.fontSize=''; delete s.fontSize; }
        if (inspColor.value){
          const hex = inspColor.value;
          const svgChild = el.querySelector && el.querySelector('svg');
          const img = el.querySelector && el.querySelector('img');
          if (svgChild){ el.style.color = hex; s.color = hex; }
          else if (img && isPngSrc(img.src)){
            recolorPngImage(img, hex).then(res=>{
              if (res.success){ s.recolored = res.dataUrl; s.originalSrc = img.dataset.__origSrc || img.src; s.color = hex; s.tintAlpha = parseFloat(inspTintAlpha.value); localStorage.setItem(stylesKey, JSON.stringify(hudStyles)); }
              else { ensureTint(el, hex, parseFloat(inspTintAlpha.value)); s.color = hex; s.tintAlpha = parseFloat(inspTintAlpha.value); localStorage.setItem(stylesKey, JSON.stringify(hudStyles)); }
            });
          } else if (el.classList.contains('speed') || el.classList.contains('distance')){ el.style.color = hex; s.color = hex; }
          else { ensureTint(el, hex, parseFloat(inspTintAlpha.value)); s.color = hex; s.tintAlpha = parseFloat(inspTintAlpha.value); }
        }
        const bVal = parseFloat(inspBrightness.value);
        if (!isNaN(bVal)){ el.style.filter = `brightness(${bVal})`; s.brightness = bVal; }
        const oVal = parseFloat(inspOpacity.value);
        if (!isNaN(oVal)){ el.style.opacity = oVal; s.opacity = oVal; }
        if (inspZ.value){ el.style.zIndex = inspZ.value; s.zIndex = inspZ.value; }
        localStorage.setItem(stylesKey, JSON.stringify(hudStyles));
      });

      insReset.addEventListener('click', ()=>{
        if (!inspectorTarget) return; const el=inspectorTarget; const id=el.id; if (hudStyles[id]){ delete hudStyles[id]; localStorage.setItem(stylesKey, JSON.stringify(hudStyles)); }
        // 重置并恢复 PNG 原始 src（若存在）
        el.style.width=''; el.style.height=''; el.style.fontSize=''; el.style.color=''; el.style.filter=''; el.style.opacity=''; el.style.zIndex='';
        const ov=el.querySelector&&el.querySelector('.tint-overlay'); if(ov) ov.style.opacity=0;
        const img = el.querySelector && el.querySelector('img'); if(img && img.dataset && img.dataset.__origSrc){ img.src = img.dataset.__origSrc; delete img.dataset.__origSrc; }
        hideInspector();
      });

      // 双向同步 range <-> number inputs for precision
      if (inspBrightness && inspBrightnessNum){
        inspBrightness.addEventListener('input', ()=>{ inspBrightnessNum.value = inspBrightness.value; });
        inspBrightnessNum.addEventListener('input', ()=>{ inspBrightness.value = inspBrightnessNum.value; });
      }
      if (inspOpacity && inspOpacityNum){
        inspOpacity.addEventListener('input', ()=>{ inspOpacityNum.value = inspOpacity.value; });
        inspOpacityNum.addEventListener('input', ()=>{ inspOpacity.value = inspOpacityNum.value; });
      }
      if (inspTintAlpha && inspTintAlphaNum){
        inspTintAlpha.addEventListener('input', ()=>{ inspTintAlphaNum.value = inspTintAlpha.value; });
        inspTintAlphaNum.addEventListener('input', ()=>{ inspTintAlpha.value = inspTintAlphaNum.value; });
      }

      // 点击空白关闭检查器
      document.addEventListener('click', (e)=>{ if (inspector && !inspector.contains(e.target)) hideInspector(); });

      /* ------------------ 拖拽 / 缩放 持久化 ------------------ */
      const posKey = 'hudPos';
      const pos = JSON.parse(localStorage.getItem(posKey) || '{}');

      // 初始化位置与尺寸（如有保存值则恢复）
      function initPos(el){
        const id = el.id;
        if (pos[id]){
          el.style.left = pos[id].x; el.style.top = pos[id].y;
          if (pos[id].w) el.style.width = pos[id].w;
          if (pos[id].h) el.style.height = pos[id].h;
        } else {
          // 默认位置按 id 分布，避免堆叠
          switch(id){
            case 'iconStraight': el.style.left = '12px'; el.style.top = '12px'; break;
            case 'iconLeft': el.style.left = '12px'; el.style.top = '120px'; break;
            case 'iconRight': el.style.left = '12px'; el.style.top = '240px'; break;
            case 'iconUturn': el.style.left = '12px'; el.style.top = '360px'; break;
            case 'distance': el.style.left = '12px'; el.style.top = '8vh'; break;
            case 'speed': el.style.left = '50%'; el.style.top = '10vh'; el.style.transform = 'translateX(-50%)'; break;
            default: el.style.left = '50%'; el.style.top = '50%'; el.style.transform = 'translate(-50%,-50%)';
          }
        }
      }
      document.querySelectorAll('.draggable').forEach(initPos);

      // 通用拖拽（点击表单控件或缩放手柄时不触发）
      function dragStart(e){
        const el = e.currentTarget;
        if (e.target && e.target.closest && e.target.closest('input,button,select,textarea,label')) return;
        if (e.target && e.target.classList && e.target.classList.contains('resize-handle')) return;

        const touch = e.type.includes('touch');
        const pt = touch ? e.touches[0] : e;
        const rect = el.getBoundingClientRect();
        const offsetX = pt.clientX - rect.left;
        const offsetY = pt.clientY - rect.top;
        el.style.transform = 'none'; // 取消初始居中偏移

        function move(ev){
          const p = touch ? ev.touches[0] : ev;
          const x = p.clientX - offsetX;
          const y = p.clientY - offsetY;
          el.style.left = x + 'px';
          el.style.top = y + 'px';
        }

        function end(){
          pos[el.id] = { x: el.style.left, y: el.style.top };
          if (el.style.width) pos[el.id].w = el.style.width;
          if (el.style.height) pos[el.id].h = el.style.height;
          localStorage.setItem(posKey, JSON.stringify(pos));
          document.removeEventListener(touch ? 'touchmove' : 'mousemove', move);
          document.removeEventListener(touch ? 'touchend' : 'mouseup', end);
        }

        document.addEventListener(touch ? 'touchmove' : 'mousemove', move, { passive: true });
        document.addEventListener(touch ? 'touchend' : 'mouseup', end);
      }

      document.querySelectorAll('.draggable').forEach(el => {
        el.addEventListener('mousedown', dragStart);
        el.addEventListener('touchstart', dragStart, { passive: true });
      });

      // 缩放逻辑（右下角手柄）
      function resizeStart(e){
        e.stopPropagation();
        const handle = e.currentTarget;
        const wrapper = handle.parentElement;
        const touch = e.type.includes('touch');
        const startX = touch ? e.touches[0].clientX : e.clientX;
        const startY = touch ? e.touches[0].clientY : e.clientY;
        const rect = wrapper.getBoundingClientRect();
        const startW = rect.width;
        const startH = rect.height;

        function move(ev){
          const p = touch ? ev.touches[0] : ev;
          const dx = p.clientX - startX;
          const dy = p.clientY - startY;
          const newW = Math.max(24, Math.round(startW + dx));
          const newH = Math.max(24, Math.round(startH + dy));
          wrapper.style.width = newW + 'px';
          wrapper.style.height = newH + 'px';
        }

        function end(){
          pos[wrapper.id] = pos[wrapper.id] || {};
          pos[wrapper.id].w = wrapper.style.width;
          pos[wrapper.id].h = wrapper.style.height;
          localStorage.setItem(posKey, JSON.stringify(pos));
          document.removeEventListener(touch ? 'touchmove' : 'mousemove', move);
          document.removeEventListener(touch ? 'touchend' : 'mouseup', end);
        }

        document.addEventListener(touch ? 'touchmove' : 'mousemove', move, { passive: true });
        document.addEventListener(touch ? 'touchend' : 'mouseup', end);
      }

      document.querySelectorAll('.resize-handle').forEach(h => {
        h.addEventListener('mousedown', resizeStart);
        h.addEventListener('touchstart', resizeStart, { passive: true });
      });

      /* ------------------ 图标切换（5s 随机切换，位置保持） ------------------ */
      const icons = ['iconStraight','iconLeft','iconRight','iconUturn'];
      let activeIcon = icons[Math.floor(Math.random() * icons.length)];

      function showActive(id){
        icons.forEach(i => {
          const el = document.getElementById(i);
          if (!el) return;
          el.style.display = (i === id) ? 'block' : 'none';
        });
      }

      function switchIcon(nextId){
        if (nextId === activeIcon) return;
        const prevEl = document.getElementById(activeIcon);
        const nextEl = document.getElementById(nextId);
        if (prevEl && nextEl){
          // 将下一个图标的位置设置为上一个图标当前的位置
          nextEl.style.left = prevEl.style.left;
          nextEl.style.top  = prevEl.style.top;
          pos[nextId] = pos[nextId] || {};
          pos[nextId].x = nextEl.style.left;
          pos[nextId].y = nextEl.style.top;
          // 拷贝尺寸（若存在）
          if (pos[activeIcon] && (pos[activeIcon].w || pos[activeIcon].h)){
            if (pos[activeIcon].w) nextEl.style.width  = pos[activeIcon].w, pos[nextId].w = pos[activeIcon].w;
            if (pos[activeIcon].h) nextEl.style.height = pos[activeIcon].h, pos[nextId].h = pos[activeIcon].h;
          }
          localStorage.setItem(posKey, JSON.stringify(pos));
        }
        activeIcon = nextId;
        showActive(activeIcon);
      }

      // 初始只显示一个并开始定时切换
      showActive(activeIcon);
      setInterval(()=>{
        const candidates = icons.filter(i => i !== activeIcon);
        const next = candidates[Math.floor(Math.random() * candidates.length)];
        switchIcon(next);
      }, 5000);

      /* ------------------ 假数据（速度在 80-120 随机变化） ------------------ */
      setInterval(()=>{
        const speed = Math.floor(Math.random() * (120 - 80 + 1)) + 80;
        document.getElementById('spdVal').textContent = speed;
      }, 300);

      let dist = 800;
      setInterval(()=>{
        dist -= 8; if (dist <= 0) dist = 800;
        document.getElementById('distance').textContent = dist + ' m';
      }, 500);
    </script>
  </body>
</html>